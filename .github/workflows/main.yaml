name: FLUTTER_MASTER
on:
    push:
        branches:
            - feature/githubActionsConfig

jobs:
    build-apps:
        runs-on: macos-latest
        steps:
            - name: Cache Primes
              id: cache-primes
              uses: actions/cache@v4
              with:
                  path: |
                      **/nodemodules
                      **/Users/Runner/
                  key: ${{ runner.os }}-primes

            - name: COPY .
              uses: actions/checkout@v4

            - name: Install - Flutter
              uses: subosito/flutter-action@v2
              with:
                  channel: stable
                  flutter-version: 3.19.5

            - name: Check - Flutter
              run: flutter doctor

            - name: Check - Flutter test
              run: flutter test

            - name: Check - Flutter analyze
              run: flutter analyze

            - name: Install - Java
              uses: actions/setup-java@v4
              with:
                  distribution: 'temurin'
                  java-version: '11'

            - name: Build - Apk
              run: flutter build apk --release

            # - name: Build - IPA
            #   run: flutter build apk --release --export-options=ios/Runner/ExportOptions.plist

            - name: Export - Artifacts
              uses: actions/upload-artifact@v4
              with:
                  name: android_apk
                  path: build/app/outputs/flutter-apk/app-release.apk

    distribute-apps:
        needs: build-apps # This is important
        runs-on: ubuntu-latest

        steps:
            - name: COPY .
              uses: actions/checkout@v4
            - uses: actions/download-artifact@v2
            #   with:
            #       name: android_apk
            #       path: ./app-release.apk
            - name: Display structure of downloaded files
              run: ls -R

            # - name: Export - Firebase distribution
            #   uses: wzieba/Firebase-Distribution-Github-Action@v1
            #   with:
            #       appId: 1:824667822746:android:708274d8bf2695f2f75d23
            #       serviceCredentialsFileContent: ${{ secrets.GOOGLE_CREDENTIALS }}
            #       groups: testers
            #       file: app-release.apk
